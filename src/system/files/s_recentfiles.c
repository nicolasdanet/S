
/* Copyright (c) 1997-2020 Miller Puckette and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

#include "../../m_spaghettis.h"
#include "../../m_core.h"

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#define RECENTFILES_MAXIMUM             10

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

static t_pathlist *recentfiles_list;    /* Static. */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

static void recentfiles_removeOldPaths (void)
{
    int n = pathlist_getSize (recentfiles_list) - RECENTFILES_MAXIMUM;
    
    while (n > 0) { n--; recentfiles_list = pathlist_removeFirst (recentfiles_list); }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL void recentfiles_append (const char *filepath)
{
    recentfiles_list = pathlist_newAppend (recentfiles_list, NULL, filepath);
}

PD_FORCE void recentfiles_clear (void)
{
    pathlist_free (recentfiles_list); recentfiles_list = NULL;
}

PD_LOCAL void recentfiles_update (void)
{
    recentfiles_removeOldPaths(); preferences_save();
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL void recentfiles_add (t_symbol *name, t_symbol *directory, int check)
{
    char filepath[PD_STRING] = { 0 };

    if (!path_withDirectoryAndName (filepath, PD_STRING, directory->s_name, name->s_name)) {
    //
    if (!check || path_isFileExistAsRegularFile (filepath)) {
    //
    recentfiles_append (filepath); recentfiles_update();
    //
    }
    //
    }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL t_pathlist *recentfiles_get (void)
{
    return recentfiles_list;
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL void recentfiles_release (void)
{
    pathlist_free (recentfiles_list);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
