
/* Copyright (c) 1997-2020 Miller Puckette and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

#include "../../m_spaghettis.h"
#include "../../m_core.h"

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL int main_start (int, char **);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#if PD_WITH_DEBUG

PD_LOCAL int sys_isControlThread (void)
{
    #if defined ( PD_BUILDING_APPLICATION )
    
    static pthread_t main; static int once = 0;
    
    pthread_t t = pthread_self();
    
    if (!once) { once = 1; main = t; return 1; }

    return (pthread_equal (main, t) != 0);
    
    #else
    
    return 0;
    
    #endif
}

#endif // PD_WITH_DEBUG

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

static_assert (sizeof (int) >= 4, "");      /* Just in case. */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#if defined ( PD_BUILDING_APPLICATION )
#if defined ( PD_WITH_MAIN )

PD_EXPORT int main (int argc, char **argv)
{
    PD_ASSERT (sys_isControlThread()); return main_start (argc, argv);
}

#endif
#endif

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
