
/* Copyright (c) 2022 Spaghettis and others. */

/* < https://www.gnu.org/licenses/agpl-3.0.en.html > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

namespace spaghettis::core {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

struct Tree {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

static bool isObject (const juce::ValueTree& tree)
{
    return (tree.getType() == Id::OBJECT || tree.getType() == Id::PATCH);
}

static bool isLine (const juce::ValueTree& tree)
{
    return (tree.getType() == Id::LINE);
}

static bool isPatch (const juce::ValueTree& tree)
{
    return (tree.getType() == Id::PATCH);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

static juce::ValueTree getChild (const juce::ValueTree& t, core::UniqueId i)
{
    return t.getChildWithProperty (Id::identifier, data::Cast::toVar (i));
}

static juce::ValueTree findChild (const juce::ValueTree& t, core::UniqueId i)
{
    juce::ValueTree found (getChild (t, i));
    
    if (!found.isValid()) {
        for (const auto& child : t) {
            if (Tree::isPatch (child)) {
                found = findChild (child, i); if (found.isValid()) { return found; }
            }
        }
    }
    
    return found;
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

static juce::String computePath (const juce::ValueTree&);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

static juce::ValueTree getItemIfChangedPropertyEquals (const juce::ValueTree& t, juce::String key);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

static core::UniqueId getIdentifier (const juce::ValueTree&);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis { using Tree = core::Tree; }

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
