
/* Copyright (c) 2021 Jojo and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace core {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

namespace {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

std::vector<UniqueId> fetchIdentifiersFromRoot (struct _object* o, struct _glist* owner)
{
    std::vector<UniqueId> t;
    
    while (owner) {
    //
    t.insert (t.cbegin(), object_getUnique (cast_object (owner)));

    owner = glist_getParent (owner);
    //
    }
    
    return t;
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

UniquePath::UniquePath() : u_ (0), r_ (0)
{

}

UniquePath::UniquePath (struct _object* o, struct _glist* owner) : u_ (object_getUnique (o)), r_ (0)
{
    if (owner) {
    //
    std::vector<UniqueId> t (fetchIdentifiersFromRoot (o, owner));
    
    if (!t.empty()) { r_ = t.front(); t.erase (t.cbegin()); }
    if (!t.empty()) { path_ = std::make_shared<std::vector<UniqueId>> (std::move (t)); }
    //
    }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

juce::String UniquePath::asString() const
{
    juce::StringArray s;
    
    s.add (isRoot() ? juce::String ("-") : juce::String (r_));
    
    if (path_) { for (auto& u : *path_) { s.add (juce::String (u)); } }
    
    s.add (juce::String (u_));
            
    return (s.joinIntoString (" / "));
}
    
// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace core

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace spaghettis

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
