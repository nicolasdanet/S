
/* Copyright (c) 2021 Jojo and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace core {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

namespace {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

std::vector<Unique::Identifier> fetchIdentifiersFromRoot (struct _object *o, struct _glist *owner)
{
    std::vector<Unique::Identifier> t;
    
    while (owner) {
    //
    t.insert (t.cbegin(), object_getUnique (cast_object (owner)));

    owner = glist_getParent (owner);
    //
    }
    
    return t;
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

Unique::Unique() : u_ (0), r_ (0)
{

}

Unique::Unique (struct _object *o, struct _glist *owner) : u_ (object_getUnique (o)), r_ (0)
{
    if (owner) {
    //
    std::vector<Unique::Identifier> t (fetchIdentifiersFromRoot (o, owner));
    
    if (!t.empty()) { r_ = t.front(); t.erase (t.cbegin()); }
    if (!t.empty()) { path_ = std::make_shared<std::vector<Unique::Identifier>> (std::move (t)); }
    //
    }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace core

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace spaghettis

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
