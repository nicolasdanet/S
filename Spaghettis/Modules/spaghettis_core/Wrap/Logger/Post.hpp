
/* Copyright (c) 2021 Spaghettis and others. */

/* < https://www.gnu.org/licenses/agpl-3.0.en.html > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

class Post {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

public:
    Post()  = default;
    ~Post() = default;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

public:
    void add (const core::UniquePath& u, const juce::String& m, LoggerType type)
    {
        const std::lock_guard<std::mutex> l (lock_); messages_.emplace_back (u, m, type);
    }
    
    void log (Logger *logger)
    {
        std::vector<LoggerMessage> scoped;
        
        {
            const std::lock_guard<std::mutex> l (lock_); scoped.swap (messages_);
        }
        
        logger->logMessage (scoped);
    }
    
private:
    std::vector<LoggerMessage> messages_;
    std::mutex lock_;

private:
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (Post)
    
// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
