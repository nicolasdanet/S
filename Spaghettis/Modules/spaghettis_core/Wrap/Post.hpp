
/* Copyright (c) 2021 Nicolas Danet. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

class Post {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

using MessagesElement   = std::tuple<juce::String, Logger::Type, Unique>;
using MessagesContainer = std::vector<MessagesElement>;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

public:
    Post() = default;
    ~Post() = default;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

public:
    void add (const juce::String& m, Logger::Type type, Unique u)
    {
        const juce::ScopedLock l (lock_); messages_.emplace_back (m, type, u);
    }
    
    void log (Logger *logger)
    {
        MessagesContainer scoped;
        
        {
            const juce::ScopedLock l (lock_); scoped.swap (messages_);
        }
        
        if (logger) {
        //
        for (const auto& e : scoped) {
            logger->logMessage (std::get<0> (e), std::get<1> (e), std::get<2> (e));
        }
        //
        }
    }
    
private:
    MessagesContainer messages_;
    juce::CriticalSection lock_;

private:
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (Post)
    
// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace spaghettis

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
