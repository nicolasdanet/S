
/* Copyright (c) 2021 Jojo and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

class Post {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

public:
    Post() = default;
    ~Post() = default;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

public:
    void add (const juce::String& m, Logger::Type type, const core::UniquePath& u)
    {
        const std::lock_guard<std::mutex> l (lock_); messages_.emplace_back (m, type, u);
    }
    
    void log (Logger *logger)
    {
        Logger::MessagesPacket scoped;
        
        {
            const std::lock_guard<std::mutex> l (lock_); scoped.swap (messages_);
        }
        
        logger->logMessage (scoped);
    }
    
private:
    Logger::MessagesPacket messages_;
    std::mutex lock_;

private:
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (Post)
    
// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace spaghettis

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
