
/* Copyright (c) 1997 Miller Puckette and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

#include "../../m_headers.h"

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

t_devices midi_devices;     /* Static. */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void midi_open (void)
{
    t_error err = devices_checkMidi (&midi_devices);
    
    if (err == PD_ERROR_NONE) { err = midi_openNative (&midi_devices); }
    
    devices_logMidi (&midi_devices, err);
}

void midi_close (void)
{
    midi_closeNative();
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void midi_poll (void)
{
    midi_pollNative();
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void midi_setCurrentDevices (t_devices *p)
{
    devices_setDefaultMidi (p);
    
    /* Close/open only if devices has changed. */
    
    if (!devices_areEquals (&midi_devices, p)) {
    //
    midi_close();

    devices_copy (&midi_devices, p);
    
    midi_open();
    //
    } else { devices_setDefault (&midi_devices, devices_hasDefault (p)); }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
