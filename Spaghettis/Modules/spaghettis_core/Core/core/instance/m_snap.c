
/* Copyright (c) 1997 Miller Puckette and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#include "../../m_spaghettis.h"
#include "../../m_core.h"

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

PD_FORCE void instance_snapSet (int n)
{
    instance_get()->pd_hasGrid = (n != 0);
}

PD_FORCE void instance_snapSetGrid (int n)
{
    instance_get()->pd_gridSize = PD_MAX (1, n);
}

PD_LOCAL int instance_snapIsSet (void)
{
    return instance_get()->pd_hasGrid;
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL int instance_snapGetGrid (void)
{
    return instance_get()->pd_gridSize;
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL int instance_snapGetSnapped (int n)
{
    int k = instance_snapGetGrid();
    
    if (n > 0) { return ((int)((n / (double)k) + 0.5) * k); }
    else {
        return ((int)((n / (double)k) - 0.5) * k);
    }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#if defined ( PD_BUILDING_APPLICATION )

juce::Point<int> instance_snapped (juce::Point<int> pt)
{
    if (instance_snapIsSet()) {
    //
    const int x = instance_snapGetSnapped (pt.getX());
    const int y = instance_snapGetSnapped (pt.getY());
    
    return juce::Point<int> (x, y);
    //
    }
    
    return pt;
}

#endif

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
