
/* Copyright (c) 1997 Miller Puckette and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#ifndef M_TIME_H_
#define M_TIME_H_

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

typedef uint64_t t_time;
typedef uint64_t t_nano;
typedef uint64_t t_stamp;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL void       time_set                    (t_time *t);
PD_LOCAL void       time_addNanoseconds         (t_time *t, t_nano ns);
PD_LOCAL t_error    time_elapsedNanoseconds     (const t_time *t0, const t_time *t1, t_nano *elapsed);
PD_LOCAL void       time_wait                   (t_time *t);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL void       nano_sleep                  (t_nano ns);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

/* < https://en.wikipedia.org/wiki/Network_Time_Protocol > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#define STAMP_TAGS_SIZE     16

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

PD_LOCAL void       stamp_set                   (t_stamp *stamp);
PD_LOCAL void       stamp_addNanoseconds        (t_stamp *stamp, t_nano ns);
PD_LOCAL t_error    stamp_elapsedNanoseconds    (const t_stamp *t0, const t_stamp *t1, t_nano *elapsed);

PD_LOCAL int        stamp_isTagElement          (t_symbol *s);
PD_LOCAL t_error    stamp_setAsTags             (int argc, t_atom *argv, t_stamp *stamp);
PD_LOCAL t_error    stamp_getWithTags           (int argc, t_atom *argv, t_stamp *stamp);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

static inline void stamp_setImmediately (t_stamp *stamp)
{
    (*stamp) = 1ULL;
}

static inline int stamp_isImmediately (t_stamp *stamp)
{
    return ((*stamp) == 1ULL);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#endif // M_TIME_H_

