
/* Copyright (c) 2022 Jojo and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace core {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void Listener::addParameterHandler (const juce::String& key, std::function<void (const Parameter&)> f)
{
    handlers_.emplace_back (key, f);
}

void Listener::valueTreePropertyChanged (juce::ValueTree& tree, const juce::Identifier&)
{
    DBG (Tree::getCopyWithSubstitutedDelegates (tree).toXmlString (juce::XmlElement::TextFormat().singleLine().withoutHeader()));
        
    if (tree.hasType (Ids::PARAMETER)) { callParameterHandlers (tree); }
    
    treeHasChanged();
}
    
void Listener::callParameterHandlers (const juce::ValueTree& tree)
{
    const Parameter parameter (tree);
    
    const juce::String key (parameter.getKey());
    
    for (const auto& h : handlers_) { if (h.key_ == key) { h.f_ (parameter); } }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace core

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace spaghettis

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
