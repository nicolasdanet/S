
/* Copyright (c) 2022 Jojo and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace core {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

Delegate::Shared::Shared (const Invariant& i) : delegate_ (Ids::DELEGATE)
{
    Invariant::setProperties (delegate_, i);
}

const juce::var& Delegate::Shared::getProperty (const juce::Identifier& identifier) const
{
    return delegate_.getProperty (identifier);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

Delegate::Shared* Delegate::Manager::create (const Invariant& i)
{
    Shared::Ptr p (new Shared (i));
    
    delegates_.push_back (p);
    
    return p.get();
}

Delegate::Shared* Delegate::Manager::getOrCreate (const Invariant& i)
{
    for (const auto& p : delegates_) {
        if (p->delegate_.getProperty (Ids::key).toString() == i.key) { return p.get(); }
    }
    
    return create (i);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace core

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace spaghettis

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
