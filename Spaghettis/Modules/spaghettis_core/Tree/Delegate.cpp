
/* Copyright (c) 2022 Jojo and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace core {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

Delegate::Shared::Shared (const Invariant& i) : prototype_ (Ids::PROTOTYPE)
{
    Invariant::setProperties (prototype_, i);
}

const juce::var& Delegate::Shared::getProperty (const juce::Identifier& identifier) const
{
    return prototype_.getProperty (identifier);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

Delegate::Shared* Delegate::Manager::create (const Invariant& i)
{
    Shared::Ptr p (new Shared (i));
    
    prototypes_.push_back (p);
    
    return p.get();
}

Delegate::Shared* Delegate::Manager::getOrCreate (const Invariant& i)
{
    for (const auto& p : prototypes_) {
        if (p->prototype_.getProperty (Ids::key).toString() == i.key) { return p.get(); }
    }
    
    return create (i);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace core

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

} // namespace spaghettis

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
