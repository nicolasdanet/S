
/* Copyright (c) 1997 Miller Puckette and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

#ifndef M_FIFO_H_
#define M_FIFO_H_

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

// TODO: Optimize?

/* https://github.com/CharlesFrasch/cppcon2023 */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

typedef struct _fifo {
    char            *f_vector;
    t_uint64Atomic  f_read;
    t_uint64Atomic  f_write;
    } t_fifo;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

t_fifo  *fifo_shared_new    (int size, int bytes);

void    fifo_shared_free    (t_fifo *x);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

int fifo_shared_getAvailableRead    (t_fifo *x);
int fifo_shared_getAvailableWrite   (t_fifo *x, int size);
int fifo_shared_write               (t_fifo *x, int size, int bytes, const void *data, int n);
int fifo_shared_read                (t_fifo *x, int size, int bytes, void       *data, int n);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

typedef t_fifo t_fifo8;
typedef t_fifo t_fifo32;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
#endif // M_FIFO_H_
