
/* Copyright (c) 2023 Spaghettis and others. */

/* < https://www.gnu.org/licenses/agpl-3.0.en.html > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

Autocomplete::Autocomplete() : hasChanged_ (false)
{

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void Autocomplete::addContent (const juce::String& s)
{
    content_.addIfNotAlreadyThere (Strings::upToWhitespace (s)); hasChanged_ = true;
}

juce::StringArray Autocomplete::getContent (const juce::String& key)
{
    if (hasChanged_) { content_.sortNatural(); hasChanged_ = false; }
    
    if (key.isNotEmpty()) { return getContentByKey (key); }
    else {
        return content_;
    }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

juce::StringArray Autocomplete::getContentByKey (const juce::String& key)
{
    const int n = content_.size();
    
    v_.clearQuick(); v_.ensureStorageAllocated (n);
    
    EditDistance distance (key);
    
    for (const auto&s : content_) {
        const int d = distance.distanceToKey (s);
        if (d >= 0) {
            v_.add (AutocompleteElement (s, d));
        }
    }
    
    v_.sort();
    
    return juce::StringArray (v_);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
