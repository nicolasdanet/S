
/* Copyright (c) 2022 Jojo and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

class ObjectComponent;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

class PainterPolicy : public juce::MouseListener {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

public:
    explicit PainterPolicy (ObjectComponent*);
    
    virtual ~PainterPolicy() = default;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

private:
    virtual void paintObject (juce::Rectangle<int>, juce::Graphics&) = 0;
    virtual juce::Rectangle<int> getRequiredBoundsForObject() = 0;

public:
    virtual std::optional<core::Vector::Real> getDimensions() = 0;
    virtual void setDimensions (core::Vector::Real) = 0;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

public:
    void paint (juce::Rectangle<int>, juce::Graphics&);

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

public:
    juce::Rectangle<int> getRequiredBounds();

    float getScale() const;
    
    core::Point::Scaled getPosition() const;

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

protected:
    void setParametersWidthAndHeight (core::Vector::Real pt);
    
// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

public:
    static auto repaint (juce::Component* component)
    {
        return [c = component]() { c->repaint(); };
    }

    static auto resized (juce::Component* component)
    {
        return [c = component]() { c->resized(); };
    }
    
// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

protected:
    ObjectComponent* component_;
    core::Object object_;
    core::Cached<juce::Colour> labelBackgroundColour_;
    core::Cached<juce::Colour> labelTextColour_;
    int objectWidth_;

public:
    static int pinHeight (float f) { return static_cast<int> (std::round (4 * f)); }
    static int pinWidth  (float f) { return static_cast<int> (std::round (8 * f)); }
    static int pinGripX  (float f) { return (f >= 1.0f) ? 1 : 0; }
    static int pinGripY  (float f) { return (f >= 1.0f) ? 3 : 0; }

private:
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (PainterPolicy)
};

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

