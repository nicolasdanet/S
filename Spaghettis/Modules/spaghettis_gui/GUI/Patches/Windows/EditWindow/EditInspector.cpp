
/* Copyright (c) 2022 Jojo and others. */

/* < https://opensource.org/licenses/BSD-3-Clause > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

EditInspector::EditInspector (EditView& view) :
    view_ (view),
    active_ (false),
    resizer_ (*this)
{
    setOpaque (true); setDefaultWidth (resizer_.getDefaultWidth());
    
    view_.attach (this);
}

EditInspector::~EditInspector()
{
    view_.detach (this);
    
    hide();
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void EditInspector::setDefaultWidth (int w)
{
    if (w >= resizer_.getMinimumWidth()) { setSize (w, getHeight()); }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

bool EditInspector::isActive() const
{
    return active_;
}
    
void EditInspector::setActive (bool isActive)
{
    active_ = isActive; triggerAsyncUpdate();
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void EditInspector::update()
{
    triggerAsyncUpdate();
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void EditInspector::paint (juce::Graphics& g)
{
    g.fillAll (Colours::fetchColour (Colours::parametersBackground));
}

void EditInspector::resized()
{
    if (parameters_ != nullptr) { parameters_->resizePanel (getLocalBounds()); }
    
    resizer_.update();
    
    if (isActive()) { view_.getPort()->updateInspector(); }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void EditInspector::show()
{
    if (parameters_ == nullptr) {
    //
    const int w = resizer_.getMinimumWidth();
    parameters_ = std::make_unique<InspectorView> (view_.getSynchronized(), w);
    parameters_->resizePanel (getLocalBounds());
    addAndMakeVisible (&parameters_->getPanel());
    //
    }
}

void EditInspector::hide()
{
    if (parameters_ != nullptr) {
    //
    removeChildComponent (&parameters_->getPanel());
    parameters_ = nullptr;
    //
    }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void EditInspector::handleAsyncUpdate()
{
    hide(); if (isActive()) { show(); }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
