
/* Copyright (c) 2024 Spaghettis and others. */

/* < https://www.gnu.org/licenses/agpl-3.0.en.html > */

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

namespace spaghettis {

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

DirectoryEditor::DirectoryEditor (const juce::Value& v) : value_ (v)
{
    addAndMakeVisible (label_);
    label_.setEditable (isEnabled());
    label_.onTextChange = [this] { updateValue(); };
    updateLabel();
    value_.addListener (this);
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void DirectoryEditor::resized()
{
    label_.setBounds (getLocalBounds());
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void DirectoryEditor::updateLabel()
{
    label_.setText (value_.toString(), juce::NotificationType::dontSendNotification);
}

void DirectoryEditor::updateValue()
{
    juce::String text (label_.getText());
    
    if (text.isEmpty())                         { value_.setValue (text); }
    else if (juce::File::isAbsolutePath (text)) { value_.setValue (juce::File (text).getFullPathName()); }
    else {
        updateLabel();
    }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
// MARK: -

void DirectoryEditor::valueChanged (juce::Value&)
{
    if (!label_.isBeingEdited()) { updateLabel(); }
}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------

}

// -----------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------
