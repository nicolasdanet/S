#! /usr/bin/env bash

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

# Must be executed at the same level.

rep=$(pwd); [ "${0%/*}" = "." ] || exit 1

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

rpi4="-mcpu=cortex-a72 -mtune=cortex-a72 -mfpu=neon-fp-armv8"

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

# Raspberry Pi 4 Model B.

if [[ $OSTYPE =~ linux-gnueabihf ]]; then
    CPUTYPE="`lscpu`"
    if [[ $CPUTYPE =~ "Cortex-A72" ]]; then
        cd Spaghettis/Builds/LinuxMakefile
        make -j4 CXX=clang++ CONFIG=RPI TARGET_ARCH="${rpi4}"
        rm -r build/intermediate
        exit 0
    fi
fi

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

# Basic platform handler.

case "$OSTYPE"  in
    darwin*)    cd Spaghettis/Builds/MacOSX ;
                xcodebuild -configuration Release ;
                rm -r build/XCBuildData ;
                rm -r build/Spaghettis.build ;;
    linux*)     cd Spaghettis/Builds/LinuxMakefile ;
                make CONFIG=Release ;
                rm -r build/intermediate ;;
    *)          exit 1 ;;
esac

# ------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------

